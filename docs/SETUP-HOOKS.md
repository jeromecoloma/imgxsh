# Git Hooks Setup for imgxsh

This guide explains how to set up pre-push validation using Lefthook to prevent CI failures.

## 🚀 Quick Setup

### 1. Install Dependencies
```bash
# macOS
brew install lefthook shellcheck shfmt

# Ubuntu/Debian
sudo apt-get install shellcheck
# For lefthook: https://github.com/evilmartians/lefthook#installation
```

### 2. Install Git Hooks
```bash
# From project root
./scripts/setup-hooks.sh
```

### 3. Verify Setup
```bash
./scripts/setup-hooks.sh --check
```

## ✅ What This Does

**Before every `git push`, the system automatically runs:**
- **ShellCheck** - Validates shell script syntax and best practices
- **shfmt** - Checks code formatting consistency  
- **Tests** - Runs the comprehensive test suite (84+ tests)

**If any check fails, the push is blocked until you fix the issues.**

## 🎯 Benefits

- ✅ **Prevents CI failures** - Same checks as GitHub Actions
- ✅ **Team consistency** - All developers get the same validation
- ✅ **Fast feedback** - Catch issues locally before pushing
- ✅ **Simple setup** - One command for new developers

## 🔧 Manual Commands

```bash
# Run all validation manually
./tests/run-tests.sh
shellcheck lib/*.sh bin/*
shfmt -d lib/*.sh bin/*

# Fix formatting issues
shfmt -w lib/*.sh bin/*

# Check hook status
./scripts/setup-hooks.sh --check
```

## 🚨 Troubleshooting

### Hook Not Running
```bash
# Reinstall hooks
./scripts/setup-hooks.sh
```

### Dependencies Missing
```bash
# Install missing tools
brew install lefthook shellcheck shfmt
```

### Bypass Validation (Not Recommended)
```bash
git push --no-verify
```

## 📁 Files

- `lefthook.yml` - Lefthook configuration (committed to repo)
- `scripts/setup-hooks.sh` - Setup script for developers
- `.git/hooks/pre-push` - Git hook (auto-generated by Lefthook)

---

**Note**: This setup is optional but highly recommended to prevent failed pushes to GitHub.
