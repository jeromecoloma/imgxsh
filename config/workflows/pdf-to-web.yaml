# PDF to Web Gallery Workflow
# Extracts images from PDF files and optimizes them for web display

name: pdf-to-web
description: "Extract PDF images and optimize for web gallery"
version: "1.0"

settings:
  output_dir: "./output/pdf-web"
  temp_dir: "/tmp/imgxsh/pdf-web"
  parallel_jobs: 4

steps:
  - name: extract_images
    type: pdf_extract
    description: "Extract all images from PDF"
    params:
      input: "{workflow_input}"
      output_dir: "{temp_dir}/extracted"
      format: "png"  # Extract as PNG to preserve quality
      
  - name: create_thumbnails
    type: resize
    description: "Create thumbnail versions"
    condition: "extracted_count > 0"
    params:
      input_dir: "{temp_dir}/extracted"
      width: 300
      height: 200
      maintain_aspect: true
      quality: 80
      output_template: "{output_dir}/thumbnails/{pdf_name}_thumb_{counter:03d}.jpg"
      
  - name: create_full_size
    type: convert
    description: "Create full-size web-optimized versions"
    condition: "extracted_count > 0"
    params:
      input_dir: "{temp_dir}/extracted"
      format: "webp"
      quality: 85
      max_width: 1200
      max_height: 800
      output_template: "{output_dir}/full/{pdf_name}_full_{counter:03d}.{format}"
      
  - name: generate_gallery_html
    type: custom
    description: "Generate HTML gallery page"
    condition: "extracted_count > 0"
    params:
      script: |
        #!/bin/bash
        # Generate simple HTML gallery
        html_file="{output_dir}/gallery.html"
        echo "Creating gallery at $html_file"

hooks:
  pre_workflow:
    - echo "Starting PDF to web gallery conversion for: {workflow_input}"
    
  post_step:
    - echo "Completed step: {step_name}"
    
  on_success:
    - echo "Gallery created successfully at: {output_dir}/gallery.html"
    - echo "Thumbnails: {output_dir}/thumbnails/"
    - echo "Full images: {output_dir}/full/"
    
  on_failure:
    - echo "Workflow failed at step: {failed_step}"
    - echo "Check logs for details"

# Template variables available:
# {workflow_input} - Input file/directory path
# {pdf_name} - Base name of PDF file without extension  
# {output_dir} - Configured output directory
# {temp_dir} - Temporary working directory
# {timestamp} - Current timestamp (YYYYMMDD_HHMMSS)
# {counter:03d} - Sequential counter with zero padding
# {step_name} - Current step name
# {extracted_count} - Number of images extracted from PDF
