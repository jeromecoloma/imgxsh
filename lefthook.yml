# Lefthook configuration for imgxsh
# This runs validation checks before pushing to prevent CI failures

pre-push:
  commands:
    shellcheck:
      run: |
        set -euo pipefail
        if [ -x ./scripts/shellcheck-check.sh ]; then
          ./scripts/shellcheck-check.sh | cat
        else
          echo "scripts/shellcheck-check.sh missing" >&2
          exit 1
        fi
      # Always run across repository (don't scope to changed files only)
      
    shfmt:
      run: |
        set -euo pipefail
        if [ -x ./scripts/shfmt-check.sh ]; then
          ./scripts/shfmt-check.sh | cat
        else
          echo "scripts/shfmt-check.sh missing" >&2
          exit 1
        fi
      # Always run across repository (don't scope to changed files only)
      
    tests:
      run: |
        set -euo pipefail
        echo "üß™ Running tests..."
        if [ -f "./tests/run-tests.sh" ]; then
          chmod +x ./tests/run-tests.sh
          SHELL_STARTER_CI_MODE=1 SHELL_STARTER_SPINNER_DISABLED=1 ./tests/run-tests.sh --ci | cat
        else
          echo "‚ö†Ô∏è  Test runner not found: ./tests/run-tests.sh"
          exit 1
        fi
      glob: "*.{sh,bats}"
